<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>VID-API Frontend</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 20px auto; }
    h1 { font-size: 22px; }
    label { display: block; margin-top: 10px; }
    input[type="number"], select { width: 120px; }
    .row { margin-bottom: 8px; }
    #log { margin-top: 15px; white-space: pre-wrap; font-size: 13px; color: #444; }
    button { margin-top: 15px; padding: 6px 12px; }
  </style>
</head>
<body>
  <h1>VID-API фронт</h1>

  <div class="row">
    <label>Видео файл:
      <input type="file" id="fileInput" accept="video/*" />
    </label>
  </div>

  <div class="row">
    <label>Ширина (символов):
      <input type="number" id="widthInput" value="120" min="10" max="240" />
    </label>
  </div>

  <div class="row">
    <label>Стиль:
      <select id="styleInput">
        <option value="normal">normal</option>
        <option value="inverted">inverted</option>
        <option value="dots">dots</option>
        <option value="gradient">gradient</option>
        <option value="blocks">blocks</option>
      </select>
    </label>
  </div>

  <div class="row">
    <label>Яркость:
      <input type="number" id="brightnessInput" value="0" min="-100" max="100" />
    </label>
  </div>

  <div class="row">
    <label>Контраст:
      <input type="number" id="contrastInput" value="0" min="-100" max="100" />
    </label>
  </div>

  <button id="convertBtn">Конвертировать</button>

  <div id="log"></div>

  <script>
    const API_URL = "http://localhost:8000/api/v1/convert/video";

    const fileInput = document.getElementById("fileInput");
    const widthInput = document.getElementById("widthInput");
    const styleInput = document.getElementById("styleInput");
    const brightnessInput = document.getElementById("brightnessInput");
    const contrastInput = document.getElementById("contrastInput");
    const convertBtn = document.getElementById("convertBtn");
    const logEl = document.getElementById("log");

    function log(msg) {
      logEl.textContent = msg;
    }

    convertBtn.addEventListener("click", async () => {
      const file = fileInput.files[0];
      if (!file) {
        alert("Выбери видео файл");
        return;
      }

      const formData = new FormData();
      formData.append("file", file);
      formData.append("width", widthInput.value);
      formData.append("style", styleInput.value);
      formData.append("brightness", brightnessInput.value);
      formData.append("contrast", contrastInput.value);

      log("Отправка запроса...");

      try {
        const resp = await fetch(API_URL, {
          method: "POST",
          body: formData
        });

        if (!resp.ok) {
          const text = await resp.text();
          log(`Ошибка ${resp.status}:\n` + text);
          return;
        }

        const contentType = resp.headers.get("content-type") || "";

        // Если backend возвращает файл (например, mp4)
        if (!contentType.includes("application/json")) {
          const blob = await resp.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "ascii_video_result"; // можешь поменять на .mp4, если знаешь формат
          document.body.appendChild(a);
          a.click();
          a.remove();
          window.URL.revokeObjectURL(url);
          log("Готово: файл скачан.");
        } else {
          // Если это JSON с данными/статусом
          const data = await resp.json();
          log("Ответ JSON:\n" + JSON.stringify(data, null, 2));
        }
      } catch (e) {
        console.error(e);
        log("Ошибка запроса: " + e);
      }
    });
  </script>
</body>
</html>
